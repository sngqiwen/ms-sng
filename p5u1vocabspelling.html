<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>P5U1 Vocabulary-Spelling</title>

<style>
:root{
  --ink:#0b1220;
  --muted:#4b5563;
  --line:#d1d5db;
  --accent:#1d4ed8;
  --next:#0284c7;
  --good:#16a34a;
  --bad:#dc2626;

  --radius:22px;
  --sans: ui-sans-serif, system-ui;

  --panelW: min(1200px, 96vw);
  --btnH: 70px;
  --btnPadX: 22px;

  --controlsPad: 160px;

  --titleSize: 32px;
  --wordSize: 88px;
  --inputSize: 26px;
  --pad: 24px;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  font-family:var(--sans);
  background:#ffffff;
  color:var(--ink);
  display:flex;
  justify-content:center;
  padding:18px;
}

/* Panel becomes a ‚Äúpage‚Äù with sticky footer */
.panel{
  width:var(--panelW);
  border:3px solid var(--line);
  border-radius:var(--radius);
  background:#fff;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
  overflow:hidden;

  min-height:100vh;
  display:flex;
  flex-direction:column;

  position:relative; /* for confetti overlay */
}

header{
  padding:18px 22px;
  border-bottom:3px solid var(--line);
}

h1{
  margin:0;
  font-size:var(--titleSize);
}

.main{
  padding:var(--pad) var(--pad) calc(var(--controlsPad) + 18px);
  display:grid;
  gap:22px;
  flex:1;
}

.topRow{
  display:flex;
  justify-content:space-between;
  font-size:18px;
  color:var(--muted);
  gap:12px;
  flex-wrap:wrap;
}

.wordBox{
  border:4px solid var(--line);
  border-radius:var(--radius);
  padding:50px 20px;
  text-align:center;
  min-height:220px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.word{
  font-size:var(--wordSize);
  font-weight:900;
  word-break:break-word;
}

.covered{
  filter: blur(18px);
  opacity:.14;
  user-select:none;
  pointer-events:none;
}

.writeRow{
  display:flex;
  gap:14px;
  align-items:center;
  flex-wrap:wrap;
  scroll-margin-bottom: calc(var(--controlsPad) + 24px);
}

input{
  flex:1;
  min-width:240px;
  padding:16px 20px;
  border-radius:18px;
  border:3px solid var(--line);
  font-size:var(--inputSize);
  outline:none;
}
input:focus{
  border-color:#93c5fd;
  box-shadow:0 0 0 6px rgba(147,197,253,.35);
}

.hidden{ display:none !important; }

.tag{
  font-size:18px;
  padding:8px 14px;
  border-radius:999px;
  font-weight:900;
  border:2px solid transparent;
}
.tag.good{ background:#f0fdf4; color:#14532d; border-color:#86efac; }
.tag.bad{ background:#fff1f2; color:#7f1d1d; border-color:#fda4af; }

.controls{
  position:sticky;
  bottom:0;
  background:rgba(255,255,255,.96);
  backdrop-filter: blur(8px);
  border-top:3px solid var(--line);
  padding:14px;
}

.btnRow{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
}

button{
  height:var(--btnH);
  padding:0 var(--btnPadX);
  border-radius:18px;
  border:3px solid var(--line);
  background:#fff;
  font-weight:900;
  font-size:18px;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  box-shadow:0 4px 0 rgba(0,0,0,.06);
  transform: translateY(0);
}
button:hover{ background:#f9fafb; }
button:active{
  transform: translateY(2px);
  box-shadow:0 2px 0 rgba(0,0,0,.06);
}
button:disabled{ opacity:.4; cursor:not-allowed; box-shadow:none; }

.primary{ background:var(--accent); color:#fff; border-color:var(--accent); }
.next{ background:var(--next); color:#fff; border-color:var(--next); }
.danger{ background:#fff1f2; color:#991b1b; border-color:#fecaca; }
.ghost{ background:#fff; }

/* Congrats page */
.congratsWrap{
  display:grid;
  gap:18px;
  padding:var(--pad);
  text-align:center;
  flex:1;
}

.congratsTitle{
  font-size:42px;
  font-weight:1000;
}

.wordsGrid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px 24px;
  font-size:24px;
  font-weight:900;
  max-width:900px;
  margin:auto;
}
.wordCell{ padding:4px 0; }

/* Badge */
.badgeWrap{
  display:flex;
  justify-content:center;
  margin-top:4px;
}
.badge{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 16px;
  border-radius:999px;
  border:3px solid #fde68a;
  background:linear-gradient(180deg,#fff7ed,#fffbeb);
  color:#7c2d12;
  font-weight:1000;
  font-size:18px;
  opacity:0;
  transform: scale(.6);
  filter: drop-shadow(0 8px 14px rgba(0,0,0,.08));
}
.badge.show{
  animation: badgePop 900ms cubic-bezier(.2,1.2,.2,1) forwards;
}
@keyframes badgePop{
  0%{ opacity:0; transform: scale(.6) translateY(6px); }
  60%{ opacity:1; transform: scale(1.08) translateY(0); }
  80%{ opacity:1; transform: scale(.98); }
  100%{ opacity:1; transform: scale(1); }
}

/* Footer (sticks at bottom because panel is flex column) */
footer{
  border-top:3px solid var(--line);
  padding:12px;
  text-align:center;
  font-size:15px;
  color:var(--muted);
  font-weight:600;
  background:#fff;
}

/* Confetti canvas overlay */
#confettiCanvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
  display:none;
}

/* Mobile */
@media(max-width:700px){
  :root{
    --titleSize:24px;
    --wordSize:56px;
    --inputSize:20px;
    --btnH:56px;
    --btnPadX:16px;
    --pad:14px;
  }
  .wordBox{ min-height:180px; padding:36px 14px; }
  .wordsGrid{ grid-template-columns:1fr; font-size:20px; }
  button{ width:100%; }
}
</style>
</head>

<body>
<section class="panel" id="panel">

  <!-- Confetti overlay -->
  <canvas id="confettiCanvas"></canvas>

  <header>
    <h1>P5U1 Vocabulary-Spelling</h1>
  </header>

  <!-- GAME PAGE -->
  <div class="main" id="gamePage">
    <div class="topRow">
      <div id="progress">Word 1 of 15</div>
      <div id="score">0/15 correct</div>
    </div>

    <div class="wordBox">
      <div class="word covered" id="targetWord"></div>
    </div>

    <div class="writeRow" id="writeRow">
      <input id="inputBox" class="hidden" placeholder="Type..." autocomplete="off" spellcheck="false" />
      <span id="resultTag" class="hidden"></span>
    </div>

    <!-- Sticky control bar -->
    <div class="controls" id="controls">
      <div class="btnRow">
        <button id="btnFullscreen" class="ghost">üñ•Ô∏è Fullscreen</button>

        <button id="btnLook">Look</button>
        <button id="btnSay" disabled>Say</button>
        <button id="btnCover" disabled>Cover</button>
        <button id="btnWrite" disabled>Write</button>

        <button id="btnCheck" class="primary" disabled>Check</button>
        <button id="btnNext" class="next">Next Word</button>
        <button id="btnReset" class="danger">Reset Word</button>
      </div>
    </div>
  </div>

  <!-- CONGRATS PAGE -->
  <div class="congratsWrap hidden" id="congratsPage">
    <div class="congratsTitle">üéâ Congratulations! üéâ</div>
    <div style="color:var(--muted); font-weight:800;">You scored <span id="finalScore">15/15</span>!</div>

    <div class="badgeWrap">
      <div class="badge" id="perfectBadge">üèÜ Perfect Score</div>
    </div>

    <div class="wordsGrid" id="wordsGrid"></div>

    <div style="display:flex; justify-content:center;">
      <button id="btnPlayAgain" class="primary" style="max-width:360px; width:100%;">Play Again</button>
    </div>
  </div>

  <footer>
    ¬© <span id="currentYear"></span> Sng Qi Wen
  </footer>

</section>

<script>
/* -------------------------
   DATA
------------------------- */
const words=[
  "lunged","yelped","errands","shoved","tugging","sprinted","smirked","dreaded","bellowed","yearning",
  "forlornly","flexibility","hesitantly","humiliating","satisfaction"
];

let idx=0;
let stage=0;
let finishedOnce=false; // prevents re-triggering confetti repeatedly

const stats=new Map();
function initStats(){
  stats.clear();
  words.forEach(w=>stats.set(w,{correct:false}));
}
initStats();

/* -------------------------
   ELEMENTS
------------------------- */
const panel=document.getElementById("panel");
const gamePage=document.getElementById("gamePage");
const congratsPage=document.getElementById("congratsPage");

const targetWord=document.getElementById("targetWord");
const inputBox=document.getElementById("inputBox");
const progress=document.getElementById("progress");
const score=document.getElementById("score");
const resultTag=document.getElementById("resultTag");
const writeRow=document.getElementById("writeRow");

const controls=document.getElementById("controls");

const wordsGrid=document.getElementById("wordsGrid");
const finalScore=document.getElementById("finalScore");
const perfectBadge=document.getElementById("perfectBadge");

const btnFullscreen=document.getElementById("btnFullscreen");
const btnLook=document.getElementById("btnLook");
const btnSay=document.getElementById("btnSay");
const btnCover=document.getElementById("btnCover");
const btnWrite=document.getElementById("btnWrite");
const btnCheck=document.getElementById("btnCheck");
const btnNext=document.getElementById("btnNext");
const btnReset=document.getElementById("btnReset");
const btnPlayAgain=document.getElementById("btnPlayAgain");

/* -------------------------
   FOOTER YEAR
------------------------- */
document.getElementById("currentYear").textContent = new Date().getFullYear();

/* -------------------------
   BULLETPROOF BOTTOM PADDING
------------------------- */
function setControlsPad(){
  const h = Math.ceil(controls.getBoundingClientRect().height);
  document.documentElement.style.setProperty("--controlsPad", (h + 24) + "px");
}
setControlsPad();
window.addEventListener("resize", setControlsPad, {passive:true});
window.addEventListener("orientationchange", ()=>setTimeout(setControlsPad, 250), {passive:true});
if ("ResizeObserver" in window){
  const ro=new ResizeObserver(()=>setControlsPad());
  ro.observe(controls);
}

/* Keep input visible (esp. mobile keyboard) */
function ensureWriteVisible(){
  writeRow.scrollIntoView({behavior:"smooth", block:"end"});
}

/* -------------------------
   BASIC TOOL LOGIC
------------------------- */
function getCorrectCount(){
  let c=0;
  for(const w of words){
    if(stats.get(w)?.correct) c++;
  }
  return c;
}

function update(){
  targetWord.textContent=words[idx];
  progress.textContent=`Word ${idx+1} of ${words.length}`;
  score.textContent=`${getCorrectCount()}/${words.length} correct`;
}

function resetStages(){
  stage=0;
  btnLook.disabled=false;
  btnSay.disabled=true;
  btnCover.disabled=true;
  btnWrite.disabled=true;
  btnCheck.disabled=true;

  inputBox.classList.add("hidden");
  inputBox.value="";
  resultTag.className="hidden";

  targetWord.classList.add("covered");
}

/* Speech (Say button) */
function speak(word){
  if("speechSynthesis" in window){
    speechSynthesis.cancel();
    speechSynthesis.speak(new SpeechSynthesisUtterance(word));
  }
}

/* Stage buttons */
btnLook.onclick=()=>{
  if(stage!==0) return;
  targetWord.classList.remove("covered");
  btnSay.disabled=false;
  stage=1;
};

btnSay.onclick=()=>{
  if(stage!==1) return;
  speak(words[idx]);
  btnCover.disabled=false;
  stage=2;
};

btnCover.onclick=()=>{
  if(stage!==2) return;
  targetWord.classList.add("covered");
  btnWrite.disabled=false;
  stage=3;
};

btnWrite.onclick=()=>{
  if(stage!==3) return;
  inputBox.classList.remove("hidden");
  btnCheck.disabled=false;
  stage=4;
  setTimeout(()=>{
    ensureWriteVisible();
    inputBox.focus({preventScroll:true});
  }, 60);
};

btnCheck.onclick=()=>{
  if(stage!==4) return;
  const typed=inputBox.value.trim().toLowerCase();
  if(!typed) return;

  resultTag.classList.remove("hidden");

  if(typed===words[idx]){
    stats.get(words[idx]).correct=true;
    resultTag.className="tag good";
    resultTag.textContent="Correct";
    targetWord.classList.remove("covered");
    speak(words[idx]);
  }else{
    resultTag.className="tag bad";
    resultTag.textContent="Try again";
    setTimeout(()=>inputBox.focus({preventScroll:true}), 30);
  }

  update();
  maybeFinish();
};

btnNext.onclick=()=>{
  idx=(idx+1)%words.length;
  update();
  resetStages();
};

btnReset.onclick=()=>{
  stats.get(words[idx]).correct=false;
  update();
  resetStages();
};

inputBox.addEventListener("keydown",e=>{
  if(e.key==="Enter") btnCheck.click();
});
inputBox.addEventListener("focus", ()=>setTimeout(()=>ensureWriteVisible(), 120), {passive:true});

/* -------------------------
   FULLSCREEN TEACHER MODE
------------------------- */
function isFullscreen(){
  return !!document.fullscreenElement;
}
async function toggleFullscreen(){
  try{
    if(!isFullscreen()){
      // Use the whole page for best projector experience
      await document.documentElement.requestFullscreen();
    }else{
      await document.exitFullscreen();
    }
  }catch(err){
    // If browser blocks fullscreen, do nothing (silent)
  }
}
btnFullscreen.onclick = toggleFullscreen;

document.addEventListener("fullscreenchange", ()=>{
  btnFullscreen.textContent = isFullscreen() ? "üñ•Ô∏è Exit Fullscreen" : "üñ•Ô∏è Fullscreen";
});

/* -------------------------
   CELEBRATION SOUND (WebAudio)
------------------------- */
let audioCtx=null;
function ensureAudio(){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  if(audioCtx.state==="suspended") audioCtx.resume();
}
function beep(freq, ms, t0){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type="sine";
  o.frequency.value=freq;

  // envelope
  const now=audioCtx.currentTime + (t0||0);
  g.gain.setValueAtTime(0.0001, now);
  g.gain.exponentialRampToValueAtTime(0.08, now+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, now+(ms/1000));

  o.connect(g); g.connect(audioCtx.destination);
  o.start(now);
  o.stop(now + (ms/1000) + 0.02);
}
function playCelebration(){
  ensureAudio();
  // simple ‚Äúta-da!‚Äù melody
  const notes=[523,659,784,1046]; // C5 E5 G5 C6
  let t=0;
  notes.forEach((n,i)=>{
    beep(n, 140, t);
    t += 0.16;
  });
  // extra sparkle
  setTimeout(()=>{ beep(1319,120,0); beep(1568,120,0.08); }, 650);
}

/* -------------------------
   CONFETTI (Canvas Overlay)
------------------------- */
const confettiCanvas=document.getElementById("confettiCanvas");
const ctx=confettiCanvas.getContext("2d");
let confettiRAF=null;

function sizeConfettiCanvas(){
  const r = panel.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  confettiCanvas.width = Math.floor(r.width * dpr);
  confettiCanvas.height = Math.floor(r.height * dpr);
  confettiCanvas.style.width = r.width + "px";
  confettiCanvas.style.height = r.height + "px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
}

function startConfetti(durationMs=2200){
  cancelConfetti();
  sizeConfettiCanvas();
  confettiCanvas.style.display="block";

  const r = panel.getBoundingClientRect();
  const pieces=[];
  const colors=["#ef4444","#f97316","#f59e0b","#22c55e","#06b6d4","#3b82f6","#a855f7","#ec4899"];

  const count = Math.min(220, Math.floor(r.width * 0.25));
  for(let i=0;i<count;i++){
    pieces.push({
      x: Math.random()*r.width,
      y: -20 - Math.random()*r.height*0.4,
      vx: (Math.random()-0.5)*2.2,
      vy: 2.2 + Math.random()*4.2,
      rot: Math.random()*Math.PI,
      vr: (Math.random()-0.5)*0.25,
      w: 6 + Math.random()*8,
      h: 8 + Math.random()*12,
      c: colors[Math.floor(Math.random()*colors.length)],
      a: 0.9
    });
  }

  const start = performance.now();
  function frame(now){
    const elapsed = now - start;
    ctx.clearRect(0,0,r.width,r.height);

    for(const p of pieces){
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.vy += 0.03;       // gravity
      p.vx *= 0.995;      // drag

      // fade out near end
      if(elapsed > durationMs * 0.7){
        p.a = Math.max(0, p.a - 0.02);
      }

      ctx.save();
      ctx.globalAlpha = p.a;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.c;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    }

    if(elapsed < durationMs){
      confettiRAF = requestAnimationFrame(frame);
    }else{
      cancelConfetti();
    }
  }
  confettiRAF = requestAnimationFrame(frame);
}

function cancelConfetti(){
  if(confettiRAF) cancelAnimationFrame(confettiRAF);
  confettiRAF=null;
  ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  confettiCanvas.style.display="none";
}

window.addEventListener("resize", ()=>{ if(confettiCanvas.style.display==="block") sizeConfettiCanvas(); }, {passive:true});

/* -------------------------
   FINISH FLOW: Congrats + Badge + Confetti + Sound
------------------------- */
function showCongrats(){
  // Build 3 columns √ó 5 rows borderless layout
  wordsGrid.innerHTML="";
  words.forEach(w=>{
    const div=document.createElement("div");
    div.className="wordCell";
    div.textContent=w;
    wordsGrid.appendChild(div);
  });

  finalScore.textContent = `${words.length}/${words.length}`;

  // Swap pages
  gamePage.classList.add("hidden");
  congratsPage.classList.remove("hidden");

  // Badge animation
  perfectBadge.classList.remove("show");
  void perfectBadge.offsetWidth; // restart animation
  perfectBadge.classList.add("show");

  // Confetti + sound
  startConfetti(2400);
  playCelebration();

  congratsPage.scrollIntoView({behavior:"smooth", block:"start"});
}

function maybeFinish(){
  if(finishedOnce) return;
  if(getCorrectCount() === words.length){
    finishedOnce = true;
    showCongrats();
  }
}

/* Play Again */
btnPlayAgain.onclick=()=>{
  finishedOnce=false;
  cancelConfetti();

  idx=0;
  stage=0;
  initStats();

  congratsPage.classList.add("hidden");
  gamePage.classList.remove("hidden");

  update();
  resetStages();
  setTimeout(()=>targetWord.scrollIntoView({behavior:"smooth", block:"center"}), 80);
};

/* Init */
update();
resetStages();
</script>

</body>
</html>
